(()=>{"use strict";var e={2003:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AgentConfig=void 0;t.AgentConfig=class{constructor(e,t,o=0,r=50){this.provider=e,this.model=t,this.temperature=o,this.recursionLimit=r}}},1412:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AgentRequest=void 0;const r=o(2003);class n{constructor(e,t,o,r,s){this.sender=e,this.content=t,this.sessionId=o,this.config=r,this.workspaceName=s,this.sessionId=o||n.generateRandomSessionId()}static fromJSON(e){const{sender:t,content:o,sessionId:s,config:i,workspaceName:a}=e;if(!o)throw new Error("Missing required field 'content'");const c=i?Object.assign(new r.AgentConfig,i):new r.AgentConfig,l=s||n.generateRandomSessionId();return new n(t,o,l,c,a)}static generateRandomSessionId(){const e="abcdefghijklmnopqrstuvwxyz0123456789";let t="";for(let o=0;o<10;o++)t+=e.charAt(Math.floor(36*Math.random()));return t}static getContentAsString(e){return"string"==typeof e?e:JSON.stringify(e)}}t.AgentRequest=n},7249:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StandardAgentStateManager=void 0;const r=o(9314),n=o(8804);t.StandardAgentStateManager=class{static createGraphState(){return{messages:{reducer:(e,t)=>e.concat(t)}}}static shouldContinue(e){const t=e.messages,o=t[t.length-1];return o.tool_calls?.length?"tools":"__end__"}static createWorkflow(e,t){const o=this.createGraphState(),s=new n.ToolNode(t);return new r.StateGraph({channels:o}).addNode("agent",(async t=>await e(t))).addNode("tools",s).addEdge("__start__","agent").addConditionalEdges("agent",this.shouldContinue).addEdge("tools","agent")}}},1350:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DevOpsAgentController=void 0;const i=o(3563),a=o(7559),c=o(1412),l=o(9055);let d=class{constructor(e){this.devOpsAgentService=e}async processRequest(e,t){t.setHeader("Content-Type","text/plain");for await(const o of this.devOpsAgentService.processRequestStream(e)){const e=JSON.stringify(o);t.write(e+"\n")}l.default.debug("Finished writing all chunks to client"),t.end()}};t.DevOpsAgentController=d,r([(0,i.Post)(),(0,i.HttpCode)(200),s(0,(0,i.Body)()),s(1,(0,i.Res)()),n("design:type",Function),n("design:paramtypes",[c.AgentRequest,Object]),n("design:returntype",Promise)],d.prototype,"processRequest",null),t.DevOpsAgentController=d=r([(0,i.Controller)("agents/devops-agent"),n("design:paramtypes",[a.DevOpsAgentService])],d)},6730:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.DevOpsAgentModule=void 0;const n=o(3563),s=o(1350),i=o(7559);let a=class{};t.DevOpsAgentModule=a,t.DevOpsAgentModule=a=r([(0,n.Module)({controllers:[s.DevOpsAgentController],providers:[i.DevOpsAgentService]})],a)},7559:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.DevOpsAgentService=void 0;const s=o(3563),i=o(1544),a=o(7249),c=o(7027),l=o(1486),d=o(9314),u=o(9055),f=o(6254);let p=class{constructor(){this.tools=[c.DevOpsTool]}async*processRequestStream(e){u.default.info("Received agent request",{agentRequest:JSON.stringify(e)});const t=i.ChatModelManager.getChatModel(e.config).bindTools(this.tools);const o=a.StandardAgentStateManager.createWorkflow((async function(e){const o=e.messages;u.default.info("Calling model with messages",{messages:JSON.stringify(o)});const r=await t.invoke(o);return u.default.info("Received model response",{response:JSON.stringify(r)}),{messages:[r]}}),this.tools),r=new d.MemorySaver,n=o.compile({checkpointer:r}),s={messages:[new l.SystemMessage({content:"You are a helpful AI assistant capable of executing DevOps tasks using shell commands. \n          Before executing any command, carefully analyze it to ensure it's not destructive or harmful to the system. \n          Reject any requests that seem potentially dangerous or are likely to cause unintended system changes. \n          Installing new tools or updating existing is totally acceptable.\n          Feel free to run commands in the shell to find out more about the current system.\n          "}),new l.HumanMessage("string"==typeof e.content?e.content:JSON.stringify(e.content))]};u.default.debug("Initial state",{initialState:JSON.stringify(s)});const c=await n.stream(s,{configurable:{thread_id:e.sessionId||"default"}});for await(const e of c){const t=f.MessageUtils.processOutputEvent(e);yield{type:t.label,content:t.content}}u.default.info("Streaming completed")}};t.DevOpsAgentService=p,t.DevOpsAgentService=p=r([(0,s.Injectable)(),n("design:paramtypes",[])],p)},2914:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ExampleAgentController=void 0;const i=o(3563),a=o(6603),c=o(1412);let l=class{constructor(e){this.exampleAgentService=e}async processRequest(e){return this.exampleAgentService.processRequest(e)}};t.ExampleAgentController=l,r([(0,i.Post)(),s(0,(0,i.Body)()),n("design:type",Function),n("design:paramtypes",[c.AgentRequest]),n("design:returntype",Promise)],l.prototype,"processRequest",null),t.ExampleAgentController=l=r([(0,i.Controller)("agents/example-agent"),n("design:paramtypes",[a.ExampleAgentService])],l)},414:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.ExampleAgentModule=void 0;const n=o(3563),s=o(2914),i=o(6603);let a=class{};t.ExampleAgentModule=a,t.ExampleAgentModule=a=r([(0,n.Module)({controllers:[s.ExampleAgentController],providers:[i.ExampleAgentService]})],a)},6603:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.ExampleAgentService=void 0;const n=o(3563),s=o(1544),i=o(7249),a=o(4548),c=o(1486),l=o(9314);let d=class{constructor(){this.tools=[a.ExampleWeatherTool]}async processRequest(e){console.log("agentRequest: "+JSON.stringify(e));const t=s.ChatModelManager.getChatModel(e.config).bindTools(this.tools);const o=i.StandardAgentStateManager.createWorkflow((async function(e){const o=e.messages;return{messages:[await t.invoke(o)]}}),this.tools),r=new l.MemorySaver,n=o.compile({checkpointer:r}),a={messages:[new c.SystemMessage({content:"You are a helpful AI assistant capable of analyzing text and using tools when necessary."}),new c.HumanMessage("string"==typeof e.content?e.content:JSON.stringify(e.content))]},d=await n.invoke(a,{configurable:{thread_id:e.sessionId||"default"}}),u=d.messages[d.messages.length-1];return console.log("Response received:",u),u.content}};t.ExampleAgentService=d,t.ExampleAgentService=d=r([(0,n.Injectable)()],d)},9852:function(e,t,o){var r,n=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SEAgentController=void 0;const a=o(3563),c=o(5017),l=o(1412);let d=r=class{constructor(e){this.seAgentService=e,this.logger=new a.Logger(r.name)}async processRequest(e,t){try{t.setHeader("Content-Type","text/event-stream"),t.setHeader("Cache-Control","no-cache"),t.setHeader("Connection","keep-alive"),t.setHeader("Location",`/sessions/${e.sessionId}/stream`);for await(const o of this.seAgentService.processRequestStream(e))t.write(`data: ${JSON.stringify(o)}\n\n`);t.end()}catch(e){this.logger.error(`Error processing request: ${e.message}`,e.stack),t.setHeader("Content-Type","application/json"),t.status(a.HttpStatus.BAD_REQUEST).json({statusCode:a.HttpStatus.BAD_REQUEST,message:"Error processing request",error:e.message,stack:void 0})}}};t.SEAgentController=d,n([(0,a.Post)(),(0,a.HttpCode)(a.HttpStatus.OK),i(0,(0,a.Body)()),i(1,(0,a.Res)()),s("design:type",Function),s("design:paramtypes",[l.AgentRequest,Object]),s("design:returntype",Promise)],d.prototype,"processRequest",null),t.SEAgentController=d=r=n([(0,a.Controller)("agents/se-agent"),s("design:paramtypes",[c.SEAgentService])],d)},3764:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.SEAgentModule=void 0;const n=o(3563),s=o(9852),i=o(5017),a=o(5873),c=o(3880),l=o(9449),d=o(3177);let u=class{};t.SEAgentModule=u,t.SEAgentModule=u=r([(0,n.Module)({imports:[a.WorkspaceModule,c.SessionModule,l.LangchainModule,d.MutationsModule],controllers:[s.SEAgentController],providers:[i.SEAgentService]})],u)},5017:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SEAgentService=void 0;const s=o(3563),i=o(8474),a=o(7373),c=o(1412),l=o(2003),d=o(1544),u=o(7249),f=o(1486),p=o(9055),h=o(6254),g=o(5515),y=o(4970),m=o(3923),v=o(7465),S=o(3765),b=o(9896),R=o(6928),w=o(9626),O=o(1e3),_=o(7602);let E=class{constructor(e,t,o,r){this.workspaceService=e,this.sessionService=t,this.checkpointerService=o,this.mutationsService=r}async*processRequestStream(e){if(!e.workspaceName)throw new Error("Workspace name is required");let t=e.config;t||(t=new l.AgentConfig);const o=await this.workspaceService.findOne(e.workspaceName);if(!o)throw new Error(`Workspace ${e.workspaceName} not found`);const r=o.buildOrTestCommand&&""!==o.buildOrTestCommand.trim()?o.buildOrTestCommand:void 0;e.sessionId||(e.sessionId=this.generateSessionId());const n=await this.sessionService.ensureSession(e.workspaceName,e.sessionId);await this.sessionService.updateSessionStatus(n.sessionId,"active"),p.default.info("Received SE agent request",{agentRequest:JSON.stringify(e)});const s=d.ChatModelManager.getChatModel(e.config),i=[new y.ReadFile(o.repoBaseDir),new m.UpdateFile(o.repoBaseDir,this.mutationsService,e.sessionId),new v.DeleteFile(o.repoBaseDir),new S.CommandLine(o.repoBaseDir)],a=s.bindTools(i),O=g.ReadWorkspaceTree.generateWorkspaceTree(o.repoBaseDir),_=R.join(o.repoBaseDir,"hints.md");let E="";b.existsSync(_)&&(E=b.readFileSync(_,"utf-8"));const j=(0,w.createSystemPrompt)(O,E,r);const M=u.StandardAgentStateManager.createWorkflow((async function(e){const t=e.messages;p.default.info("Calling model with messages",{messages:JSON.stringify(t)});const o=await a.invoke(t);return p.default.info("Received model response",{response:JSON.stringify(o)}),{messages:[o]}}),i),A=this.checkpointerService.getCheckpointer(),P=M.compile({checkpointer:A}),C=c.AgentRequest.getContentAsString(e.content);await this.sessionService.addItem(e.sessionId,"Human",C);let T=t.recursionLimit?t.recursionLimit:50;const k={configurable:{thread_id:e.sessionId},recursionLimit:T};p.default.debug("Checkpoint config",k);const I=await A.get(k),D=new f.HumanMessage(C);let x={messages:[]};x.messages=I?[D]:[new f.SystemMessage({content:j}),D],p.default.debug("Initial state",x);const F=await P.stream(x,k);try{for await(const t of F){p.default.debug("Output Event was:",t);const o=h.MessageUtils.processOutputEvent(t);p.default.debug("Processed message",o);const r=await this.sessionService.addItem(e.sessionId,o.label,o.content);yield r}}catch(t){p.default.error("Error in SE Agent:",t);const o={label:"Error",content:`An error occurred: ${t.message}`};await this.sessionService.addItem(e.sessionId,o.label,o.content),yield o}finally{await this.sessionService.updateSessionStatus(e.sessionId,"inactive"),p.default.info("SE Agent processing completed")}}generateSessionId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="";for(let o=0;o<10;o++)t+=e.charAt(Math.floor(62*Math.random()));return t}};t.SEAgentService=E,t.SEAgentService=E=r([(0,s.Injectable)(),n("design:paramtypes",[i.WorkspaceService,a.SessionService,O.CheckpointerService,_.MutationsService])],E)},9626:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSystemPrompt=function(e,t,o){let r="As an AI assistant, you are tasked analysing the software system and answering questions about it and/or making improvements to it.\nFollow these guidelines:\n1. Review the file structure tree below and the read_file tool to answer questions about the system and suggest improvements where appropriate.\n2. When making changes to the system:\n   a. First, fetch all the files you think you might need using the read_file tool.\n   b. Make a clear plan with multiple steps.\n   c. Iterate through the plan, one step at a time.\n   d. Think step-by-step and explain the needed changes in a few short sentences.\n   e. Each change MUST be done by invoking the update_file tool to replace a part of the file with a new bit.\n3. Use the read_file tool to retrieve the contents of specific files when needed rather than guessing at what they contain.\n   When making edits to previously referenced files, always keep the name/path the same.\n4. When choosing a file path for generated artifacts, consider the structure and choose a logical location.\n5. When a specific file name is mentioned, look for it in the structure below and use the read_file tool to get the content of that file.\n6. Consider the following when suggesting improvements:\n   a. Code organization and structure\n   b. Adherence to best practices and design patterns\n   c. Performance optimizations\n   d. Security considerations\n   e. Scalability and maintainability\n   f. Documentation and comments\n7. Provide clear explanations for your suggestions and recommendations.\n8. If you need to create new files or modify existing ones, clearly indicate the file path and content.\n9. When generating new code or modifying existing code, always look at similar or nearby files in the source tree for guidance on:\n   a. Code style and formatting\n   b. Logging practices\n   c. Error handling\n   d. Import statements and module organization\n   e. Commenting style and docstring format\n   f. Naming conventions for variables, functions, and classes\n   g. Tools, libraries, and frameworks being used\n10. To find similar files:\n    a. Examine the file structure provided below.\n    b. Identify files in the same directory or nearby directories with similar purposes or file extensions.\n    c. Use the read_file tool to retrieve the contents of these similar files for reference.\n11. Ensure that new code generation and modifications align with the existing codebase's style and best practices.\n12. Do not make assumptions about tools, libraries, or frameworks being used:\n    a. Always fetch and examine similar existing files before creating new ones.\n    b. When adding a new entity or data class, fetch an existing one first and use the same tooling and styles.\n    c. For data migrations, look at an existing migration file to understand the tooling and practices used in the repository.\n    d. Consistently use the same tools and approaches found in the existing codebase.\n13. When making changes to the system use the update_file tool as follows:\n    a. Always provide the path to the file you want to change (or create) as the first argument.\n    b. The second argument is the SEARCH block - the bit of the existing code you want to replace. For new files this should be an empty string.\n    c. The third argument is the REPLACE block - the bit of the new code you want to replace it with. DO NOT FORGET TO INCLUDE THIS!!\n    d. Always try to minimise the size of the SEARCH block so you are only updating the specific parts of the file that need updating.\n    e. If you need to make edits to multiple parts of a single file, make a plan and do so in a series of update_file calls.\n    f. If you get an error back from the tool saying the search block was not found then you can try again with a larger search block or the entire contents of the file as the search block.\n14. To delete a file, use the delete_file tool:\n    a. Provide the relative path of the file to delete as the argument.\n    b. Always confirm the file deletion with the user before proceeding.\n15. When refactoring or renaming files:\n    a. Use the update_file tool to create the new file with the desired content.\n    b. Use the delete_file tool to remove the old file.\n    c. Update any references to the old file in other parts of the codebase using the update_file tool.\n16. After making changes to the system, always commit the changes to git using the following steps:\n    a. Use the command_line tool with command 'git add -A && git commit -m \"<suitable commit message>\"'\n    b. Replace \"<suitable commit message>\" with a brief, descriptive message of the changes you've made.\n    c. Do not try to git add individual files, always use 'git add -A' as above.\n17. If the user asks you to undo or /undo or undo the last changes, use the command_line tool with the command \"git reset --hard HEAD~1\"\n18. You can use the command_line tool to execute commands in the workspace directory, not just git commands. This includes system commands, package managers, build tools, etc. But remember the following:\n    a. Do not traverse up above the workspace directory though and only do things that are safe and can definitely be undone.\n    b. Only use package manager/build commands if you are sure of the correct one. Look in the readme or the build files to find out for sure and if not sure then do not use them. Just say what you might do to complete the task.";o&&(r+=`\n19. After making changes to the system, but before committing them to git, consider the following:\n    a. If you have updated any code files (not just scripts, documentation, or other non-code files), you should run the following command to test if the changes haven't broken anything:\n       Use the command_line tool to execute this command: ${o}\n    b. If you run the test and any errors occur, try to fix them if it seems feasible.\n    c. If the errors cannot be fixed easily, stop processing and report the error to the user without committing the changes to git.\n    d. If you don't run the test or if the build or test is successful, proceed with committing the changes to git.\n    e. Remember, you only need to run this test command if you've made changes to actual code files, not for changes to scripts, documentation, or other non-code files.`);return r+=`\n\nHere is the file tree of the system:\n${e}\n\n${t?`Additional hints:\n${t}`:""}\n\n${o?`Build or Test Command: ${o}`:""}\n\nIMPORTANT: When using the update_file tool you MUST provide all 3 arguments: filePath, search & REPLACE. DO NOT FORGET TO INCLUDE THE REPLACE BLOCK!!\nIMPARTANT: You must NEVER try to stop processes or kill running processes. You must only use the command_line tool to execute commands.\n${o?"IMPORTANT: REMEMBER TO RUN THE BUILD OR TEST COMMAND IF YOU HAVE MADE CHANGES TO THE CODE FILES BEFORE THEN COMMITTING YOUR CHANGES TO GIT!":"IMPORTANT: ALWAYS COMMIT YOUR CHANGES TO GIT AFTER MAKING THEM!"}\n`,r}},715:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.AppModule=void 0;const n=o(3563),s=o(2810),i=o(6928),a=o(6808),c=o(414),l=o(6730),d=o(3764),u=o(5873),f=o(3880),p=o(7535),h=o(9449),g=o(3177),y=o(3049),m=o(376),v=o(7967);let S=class{};t.AppModule=S,t.AppModule=S=r([(0,n.Module)({imports:[s.ServeStaticModule.forRoot({rootPath:(0,i.join)(__dirname,"..","..","vitify-webui","dist"),exclude:["/api*"]}),m.DataSourceModule,a.HelloWorldModule,u.WorkspaceModule,f.SessionModule,c.ExampleAgentModule,l.DevOpsAgentModule,d.SEAgentModule,p.AgentsModule,h.LangchainModule,g.MutationsModule,y.AudioTranscriptionModule,v.ConfigModule]})],S)},2776:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initializeDataSource=t.getDataSource=t.appDataSource=t.AppDataSource=void 0;const r=o(6689),n=o(857),s=o(6928),i=o(9896),a=o(9055),c=o(5095),l=s.join(n.homedir(),".hldk","db","hldk.sqlite"),d=process.env.HLDK_DB_PATH||l;class u{constructor(){a.default.info(`Connecting to the database at ${d}`),i.existsSync(d)||(a.default.info(`Database path ${d} does not exist, creating it`),i.mkdirSync(s.dirname(d),{recursive:!0})),this.db=new r.Database(d,(e=>{if(e)throw a.default.error(`Error opening database: ${e.message}`),e;a.default.info(`Connected to the database at ${d}`)}))}async initialize(){await this.runMigrations()}async runMigrations(){const e=new c.Flyway({url:`jdbc:sqlite:${d}`,user:"",password:"",migrationLocations:["filesystem:src/migrations"]});try{const t=await e.migrate();if(!t.success)throw new Error(`Migration failed: ${t.error}`);a.default.info("Database migration completed successfully")}catch(e){throw a.default.error("Error running database migrations:",e),e}}async query(e,t=[]){return new Promise(((o,r)=>{this.db.all(e,t,((e,t)=>{e?r(e):o(t)}))}))}async run(e,t=[]){return new Promise(((o,r)=>{this.db.run(e,t,(e=>{e?r(e):o()}))}))}async close(){return new Promise(((e,t)=>{this.db.close((o=>{o?t(o):e()}))}))}buildPaginationQuery(e,t){const o=(t.page-1)*t.limit;return`${e} LIMIT ${t.limit} OFFSET ${o}`}buildSortQuery(e,t){return`${e} ORDER BY ${t.field} ${t.order}`}}t.AppDataSource=u,t.appDataSource=new u;t.getDataSource=async()=>{if(!t.appDataSource)throw new Error("AppDataSource has not been initialized");return t.appDataSource};t.initializeDataSource=async()=>{await t.appDataSource.initialize()}},376:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.DataSourceModule=void 0;const n=o(3563),s=o(2776);let i=class{};t.DataSourceModule=i,t.DataSourceModule=i=r([(0,n.Module)({providers:[{provide:"DATA_SOURCE",useFactory:async()=>(await(0,s.initializeDataSource)(),(0,s.getDataSource)())}],exports:["DATA_SOURCE"]})],i)},1544:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChatModelManager=void 0;const r=o(4264),n=o(1986),s=o(2003),i=o(8884);class a{constructor(){this.providers=[new r.OpenAIProvider,new n.AnthropicProvider]}static getInstance(){return a.instance||(a.instance=new a),a.instance}static getChatModel(e){return a.getInstance().getChatModel(e)}getChatModel(e){const t=e?.provider||(0,i.getEnv)("LLM_PROVIDER","anthropic");if(!t)throw new Error("No LLM provider specified");const o=this.providers.find((e=>e.getName()===t));if(!o)throw new Error(`Unsupported LLM provider: ${t}`);return console.log(`Using provider: ${t}`),o.getModel(e||new s.AgentConfig)}}t.ChatModelManager=a},1e3:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CheckpointerService=void 0;const s=o(3563),i=o(9314);let a=class{constructor(){this.checkpointer=new i.MemorySaver}getCheckpointer(){return this.checkpointer}};t.CheckpointerService=a,t.CheckpointerService=a=r([(0,s.Injectable)(),n("design:paramtypes",[])],a)},9449:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.LangchainModule=void 0;const n=o(3563),s=o(1e3);let i=class{};t.LangchainModule=i,t.LangchainModule=i=r([(0,n.Module)({providers:[s.CheckpointerService],exports:[s.CheckpointerService]})],i)},6254:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageUtils=void 0;const r=o(1486),n=o(9055);class s{static processOutputEvent(e){let t=e.messages,o="AI",i="No content found";if(!t&&e.agent&&e.agent.messages?t=e.agent.messages:!t&&e.tools&&e.tools.messages&&(t=e.tools.messages,o="Tool"),t&&t.length>0){const a=t[t.length-1];if(a instanceof r.ToolMessage||"tool"===a.type){return{label:"Tool",content:`Calling ${a.name||"Unknown Tool"}\nOutput was:\n${s.processContent(a.content)}`}}if(a instanceof r.AIMessage)return i=s.processContent(a.content),i.trim().length<1?(n.default.warn("AI message has empty content",{lastMessage:JSON.stringify(a)}),{label:"AI",content:JSON.stringify(a)}):{label:"AI",content:i};if(a instanceof r.HumanMessage)return i=s.processContent(a.content),{label:"Human",content:i};if(a instanceof r.BaseMessage)return i=s.processContent(a.content),{label:o,content:i};n.default.warn("Processing unknown output using strings",{output:JSON.stringify(e)});const c=JSON.stringify(a),l=JSON.parse(c);if("kwargs"in l&&l.kwargs&&l.kwargs.content)return i=l.kwargs.content,{label:o,content:i}}return n.default.warn("Processing unknown output",{output:JSON.stringify(e)}),{label:"Unknown",content:JSON.stringify(e)}}static processContent(e){return Array.isArray(e)?e.filter((e=>"text"===e.type)).map((e=>e.text)).join("\n"):String(e)}}t.MessageUtils=s},1986:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AnthropicProvider=void 0;const r=o(646),n=o(8483),s=o(8884);class i extends n.BaseProvider{getName(){return"anthropic"}getModel(e){return new r.ChatAnthropic({modelName:this.getModelName(e,"claude-3-5-sonnet-20240620"),temperature:e.temperature,anthropicApiKey:(0,s.getEnv)("ANTHROPIC_API_KEY"),maxTokens:8192})}}t.AnthropicProvider=i},8483:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseProvider=void 0;const r=o(8884);t.BaseProvider=class{getModelName(e,t){if(e?.model)return e.model;const o=`${this.getName().toUpperCase()}_MODEL`,n=(0,r.getEnv)(o);return n||t}}},4264:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OpenAIProvider=void 0;const r=o(6228),n=o(8483),s=o(8884);class i extends n.BaseProvider{getName(){return"openai"}getModel(e){return new r.ChatOpenAI({modelName:this.getModelName(e,"gpt-4o"),temperature:e.temperature,openAIApiKey:(0,s.getEnv)("OPENAI_API_KEY")})}}t.OpenAIProvider=i},2231:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AgentsController=void 0;const s=o(3563),i=o(7504);let a=class{constructor(e){this.agentsService=e}getAgents(){return this.agentsService.getAgents()}};t.AgentsController=a,r([(0,s.Get)(),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",void 0)],a.prototype,"getAgents",null),t.AgentsController=a=r([(0,s.Controller)("agents"),n("design:paramtypes",[i.AgentsService])],a)},7535:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.AgentsModule=void 0;const n=o(3563),s=o(2231),i=o(7504);let a=class{};t.AgentsModule=a,t.AgentsModule=a=r([(0,n.Module)({controllers:[s.AgentsController],providers:[i.AgentsService]})],a)},7504:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.AgentsService=void 0;const n=o(3563);let s=class{getAgents(){return[{name:"DevOps Agent",url:"/agents/devops-agent"},{name:"SE Agent",url:"/se-agent"}]}};t.AgentsService=s,t.AgentsService=s=r([(0,n.Injectable)()],s)},885:function(e,t,o){var r,n=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},i=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AudioTranscriptionController=void 0;const a=o(3563),c=o(9556),l=o(4562),d=o(8461);let u=class{constructor(e){this.audioTranscriptionService=e}async transcribeAudio(e){try{return{transcription:await this.audioTranscriptionService.transcribe(e.buffer.toString("base64"))}}catch(e){throw console.error("Transcription error:",e),new Error("An error occurred during transcription")}}};t.AudioTranscriptionController=u,n([(0,a.Post)(),(0,a.UseInterceptors)((0,c.FileInterceptor)("audio")),i(0,(0,a.UploadedFile)()),s("design:type",Function),s("design:paramtypes",["function"==typeof(r=void 0!==d.Multer&&d.Multer.File)?r:Object]),s("design:returntype",Promise)],u.prototype,"transcribeAudio",null),t.AudioTranscriptionController=u=n([(0,a.Controller)("audio-transcription"),s("design:paramtypes",[l.AudioTranscriptionService])],u)},3049:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.AudioTranscriptionModule=void 0;const n=o(3563),s=o(885),i=o(4562);let a=class{};t.AudioTranscriptionModule=a,t.AudioTranscriptionModule=a=r([(0,n.Module)({controllers:[s.AudioTranscriptionController],providers:[i.AudioTranscriptionService,s.AudioTranscriptionController]})],a)},4562:function(e,t,o){var r,n=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.AudioTranscriptionService=void 0;const s=o(3563),i=o(5317),a=o(9896),c=o(857),l=o(6928);let d=r=class{constructor(){this.logger=new s.Logger(r.name)}async transcribe(e){this.logger.debug("Starting audio transcription");const t=Buffer.from(e,"base64"),o=l.join(c.tmpdir(),`audio-${Date.now()}.wav`);await a.promises.writeFile(o,t),this.logger.debug(`Temporary file created: ${o}`);try{const e=await this.runFasterWhisperCLI(o);return this.logger.debug("Transcription completed successfully"),e}finally{await a.promises.unlink(o),this.logger.debug(`Temporary file deleted: ${o}`)}}runFasterWhisperCLI(e){return new Promise(((t,o)=>{const r=l.join(c.tmpdir(),`audio-${Date.now()}.srt`);this.logger.debug(`Running Faster Whisper CLI on file: ${e}`);const n=(0,i.spawn)("faster-whisper",[e,"-o",r,"--without_timestamps","True"]);n.stdout.on("data",(e=>{this.logger.debug(`Faster Whisper stdout: ${e}`)})),n.stderr.on("data",(e=>{this.logger.warn(`Faster Whisper stderr: ${e}`)})),n.on("error",(e=>{this.logger.error(`Error in Faster Whisper process: ${e}`),o(new Error("Error in Faster Whisper process - make sure you have run the ./scripts/install-faster-whisper.sh script"))})),n.on("close",(async e=>{if(0===e)try{const e=await a.promises.readFile(r,"utf-8");this.logger.debug(`SRT content: ${e}`);const o=this.parseSrtContent(e);this.logger.debug("Faster Whisper process completed successfully"),t(o)}catch(e){this.logger.error(`Error reading SRT file: ${e}`),o(new Error(`Error reading SRT file: ${e.message}`))}finally{await a.promises.unlink(r),this.logger.debug(`Temporary SRT file deleted: ${r}`)}else this.logger.error(`Faster Whisper process exited with code ${e}`),o(new Error(`Faster Whisper process exited with code ${e}`))}))}))}parseSrtContent(e){const t=e.split("\n");let o="";for(let e=0;e<t.length;e++)/^\d+$/.test(t[e])||/.*-->.*$/.test(t[e])||(o+=t[e].trim()+" ");return o.trim()}};t.AudioTranscriptionService=d,t.AudioTranscriptionService=d=r=n([(0,s.Injectable)()],d)},5015:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigController=void 0;const s=o(3563),i=o(2368);let a=class{constructor(e){this.configService=e}getConfig(){return this.configService.getConfig()}};t.ConfigController=a,r([(0,s.Get)(),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",void 0)],a.prototype,"getConfig",null),t.ConfigController=a=r([(0,s.Controller)("config"),n("design:paramtypes",[i.ConfigService])],a)},1080:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigProperty=void 0;t.ConfigProperty=class{constructor(e,t){this.name=e,this.value=t}}},7967:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigModule=void 0;const n=o(3563),s=o(5015),i=o(2368),a=o(5699),c=o(2776);let l=class{};t.ConfigModule=l,t.ConfigModule=l=r([(0,n.Module)({controllers:[s.ConfigController],providers:[i.ConfigService,a.ConfigPropertyRepository,{provide:"DATA_SOURCE",useFactory:()=>c.AppDataSource}],exports:[i.ConfigService,a.ConfigPropertyRepository]})],l)},5699:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigPropertyRepository=void 0;const i=o(3563),a=o(2776),c=o(1080);let l=class{constructor(e){this.dataSource=e}async getProperty(e){const t=await this.dataSource.query("SELECT value FROM config_properties WHERE name = ?",[e]);return t[0]?.value||null}async setProperty(e,t){null===t?await this.dataSource.run("DELETE FROM config_properties WHERE name = ?",[e]):await this.dataSource.run("INSERT OR REPLACE INTO config_properties (name, value) VALUES (?, ?)",[e,t])}async getAllProperties(){return(await this.dataSource.query("SELECT * FROM config_properties")).map((e=>new c.ConfigProperty(e.name,e.value)))}async deleteProperty(e){await this.dataSource.run("DELETE FROM config_properties WHERE name = ?",[e])}};t.ConfigPropertyRepository=l,t.ConfigPropertyRepository=l=r([(0,i.Injectable)(),s(0,(0,i.Inject)("DATA_SOURCE")),n("design:paramtypes",[a.AppDataSource])],l)},2368:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigService=void 0;const n=o(3563);let s=class{getConfig(){return{version:"0.2.0",maskedAnthropicApiKey:this.maskApiKey(process.env.ANTHROPIC_API_KEY)}}maskApiKey(e){if(!e)return"not set";if(e.length<=12)return e;const t=e.length-8-4;return e.slice(0,8)+"*".repeat(t)+e.slice(-4)}};t.ConfigService=s,t.ConfigService=s=r([(0,n.Injectable)()],s)},5096:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.HelloWorldController=void 0;const s=o(3563),i=o(5533);let a=class{constructor(e){this.helloWorldService=e}getHello(){return this.helloWorldService.getHello()}};t.HelloWorldController=a,r([(0,s.Get)(),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",String)],a.prototype,"getHello",null),t.HelloWorldController=a=r([(0,s.Controller)("hello-world"),n("design:paramtypes",[i.HelloWorldService])],a)},6808:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.HelloWorldModule=void 0;const n=o(3563),s=o(5096),i=o(5533);let a=class{};t.HelloWorldModule=a,t.HelloWorldModule=a=r([(0,n.Module)({controllers:[s.HelloWorldController],providers:[i.HelloWorldService]})],a)},5533:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.HelloWorldService=void 0;const n=o(3563);let s=class{getHello(){return"Hello World!"}};t.HelloWorldService=s,t.HelloWorldService=s=r([(0,n.Injectable)()],s)},2303:(e,t)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.Mutation=t.MutationType=void 0,function(e){e.CREATE="create",e.UPDATE="update",e.DELETE="delete"}(o||(t.MutationType=o={}));t.Mutation=class{constructor(e,t,o,r,n,s,i,a){this.id=e,this.type=t,this.filePath=o,this.description=r,this.fileContentsBefore=n,this.fileContentsAfter=s,this.updatedAt=i,this.sessionId=a}}},672:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MutationRepository=void 0;const i=o(3563),a=o(2776),c=o(3903);let l=class{constructor(e){this.dataSource=e}async findAll(e,t){let o="SELECT * FROM mutations";return t&&(o=this.dataSource.buildSortQuery(o,t)),e&&(o=this.dataSource.buildPaginationQuery(o,e)),this.dataSource.query(o)}async findById(e){return(await this.dataSource.query("SELECT * FROM mutations WHERE id = ?",[e]))[0]||null}async findBySessionId(e,t,o){let r="SELECT * FROM mutations WHERE sessionId = ?";return o&&(r=this.dataSource.buildSortQuery(r,o)),t&&(r=this.dataSource.buildPaginationQuery(r,t)),this.dataSource.query(r,[e])}async create(e){const t=(0,c.v4)(),o=(new Date).toISOString();return await this.dataSource.run("INSERT INTO mutations (id, type, filePath, description, fileContentsBefore, fileContentsAfter, sessionId, updatedAt) VALUES (?, ?, ?, ?, ?, ?, ?, ?)",[t,e.type,e.filePath,e.description,e.fileContentsBefore,e.fileContentsAfter,e.sessionId,o]),t}async update(e,t){const o=Object.keys(t).map((e=>`${e} = ?`)).join(", "),r=Object.values(t);await this.dataSource.run(`UPDATE mutations SET ${o} WHERE id = ?`,[...r,e])}async delete(e){await this.dataSource.run("DELETE FROM mutations WHERE id = ?",[e])}};t.MutationRepository=l,t.MutationRepository=l=r([(0,i.Injectable)(),s(0,(0,i.Inject)("DATA_SOURCE")),n("design:paramtypes",[a.AppDataSource])],l)},9989:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MutationsController=void 0;const i=o(3563),a=o(7602);let c=class{constructor(e){this.mutationsService=e}async getMutationsForSession(e){return this.mutationsService.getMutationsForSession(e)}async getMutation(e){return this.mutationsService.getMutation(e)}};t.MutationsController=c,r([(0,i.Get)("session/:sessionId"),s(0,(0,i.Param)("sessionId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],c.prototype,"getMutationsForSession",null),r([(0,i.Get)(":id"),s(0,(0,i.Param)("id")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],c.prototype,"getMutation",null),t.MutationsController=c=r([(0,i.Controller)("mutations"),n("design:paramtypes",[a.MutationsService])],c)},3177:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.MutationsModule=void 0;const n=o(3563),s=o(376),i=o(9989),a=o(7602),c=o(672);let l=class{};t.MutationsModule=l,t.MutationsModule=l=r([(0,n.Module)({imports:[s.DataSourceModule],controllers:[i.MutationsController],providers:[a.MutationsService,c.MutationRepository],exports:[a.MutationsService]})],l)},7602:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.MutationsService=void 0;const s=o(3563),i=o(672);let a=class{constructor(e){this.mutationRepository=e}async getMutationsForSession(e){return(await this.mutationRepository.findBySessionId(e,void 0,{field:"updatedAt",order:"DESC"})).map((e=>({id:e.id,type:e.type,filePath:e.filePath,updatedAt:e.updatedAt,description:e.description,fileContentsBefore:e.fileContentsBefore,fileContentsAfter:e.fileContentsAfter})))}async getMutation(e){return this.mutationRepository.findById(e)}async createMutation(e){if(!e.sessionId)throw new Error("sessionId is required to create a mutation");return await this.mutationRepository.create({...e,updatedAt:e.updatedAt||new Date})}};t.MutationsService=a,t.MutationsService=a=r([(0,s.Injectable)(),n("design:paramtypes",[i.MutationRepository])],a)},9095:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ItemRepository=void 0;const i=o(3563),a=o(2776);let c=class{constructor(e){this.dataSource=e}async findAll(e,t){let o="SELECT * FROM items";return t&&(o=this.dataSource.buildSortQuery(o,t)),e&&(o=this.dataSource.buildPaginationQuery(o,e)),this.dataSource.query(o)}async findById(e){return(await this.dataSource.query("SELECT * FROM items WHERE itemId = ?",[e]))[0]||null}async findBySessionId(e,t,o){let r="SELECT * FROM items WHERE sessionId = ?";return o&&(r=this.dataSource.buildSortQuery(r,o)),t&&(r=this.dataSource.buildPaginationQuery(r,t)),this.dataSource.query(r,[e])}async create(e){await this.dataSource.run("INSERT INTO items (itemId, sessionId, label, content, createdAt) VALUES (?, ?, ?, ?, ?)",[e.itemId,e.sessionId,e.label,e.content,e.createdAt])}async update(e,t){const o=Object.keys(t).map((e=>`${e} = ?`)).join(", "),r=Object.values(t);await this.dataSource.run(`UPDATE items SET ${o} WHERE itemId = ?`,[...r,e])}async delete(e){await this.dataSource.run("DELETE FROM items WHERE itemId = ?",[e])}async countBySessionId(e){return(await this.dataSource.query("SELECT COUNT(*) as count FROM items WHERE sessionId = ?",[e]))[0].count}};t.ItemRepository=c,t.ItemRepository=c=r([(0,i.Injectable)(),s(0,(0,i.Inject)("DATA_SOURCE")),n("design:paramtypes",[a.AppDataSource])],c)},5480:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SessionController=void 0;const i=o(3563),a=o(7373),c=o(573);let l=class{constructor(e){this.sessionService=e}async createSession(e,t){return this.sessionService.ensureSession(e,t)}async getSessions(e=1,t=10,o="createdAt",r="DESC"){return this.sessionService.getSessions(e,t,o,r)}async getSession(e){return this.sessionService.getSession(e)}async deleteSession(e){return this.sessionService.deleteSession(e)}async getItemsForSession(e,t=1,o=100,r="ASC"){const[n,s]=await this.sessionService.getItemsForSession(e,t,o,r);return{items:n,total:s}}streamSessionItems(e){return this.sessionService.streamSessionItems(e)}};t.SessionController=l,r([(0,i.Post)(),s(0,(0,i.Body)("workspaceName")),s(1,(0,i.Body)("sessionId")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],l.prototype,"createSession",null),r([(0,i.Get)(),s(0,(0,i.Query)("page")),s(1,(0,i.Query)("limit")),s(2,(0,i.Query)("sortBy")),s(3,(0,i.Query)("sortOrder")),n("design:type",Function),n("design:paramtypes",[Number,Number,String,String]),n("design:returntype",Promise)],l.prototype,"getSessions",null),r([(0,i.Get)(":sessionId"),s(0,(0,i.Param)("sessionId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],l.prototype,"getSession",null),r([(0,i.Delete)(":sessionId"),s(0,(0,i.Param)("sessionId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],l.prototype,"deleteSession",null),r([(0,i.Get)(":sessionId/items"),s(0,(0,i.Param)("sessionId")),s(1,(0,i.Query)("page")),s(2,(0,i.Query)("limit")),s(3,(0,i.Query)("sortOrder")),n("design:type",Function),n("design:paramtypes",[String,Number,Number,String]),n("design:returntype",Promise)],l.prototype,"getItemsForSession",null),r([(0,i.Sse)(":sessionId/stream"),s(0,(0,i.Param)("sessionId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",c.Observable)],l.prototype,"streamSessionItems",null),t.SessionController=l=r([(0,i.Controller)("sessions"),n("design:paramtypes",[a.SessionService])],l)},3880:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.SessionModule=void 0;const n=o(3563),s=o(376),i=o(5480),a=o(7373),c=o(3936),l=o(9095);let d=class{};t.SessionModule=d,t.SessionModule=d=r([(0,n.Module)({imports:[s.DataSourceModule],controllers:[i.SessionController],providers:[a.SessionService,c.SessionRepository,l.ItemRepository],exports:[a.SessionService]})],d)},3936:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SessionRepository=void 0;const i=o(3563),a=o(2776);let c=class{constructor(e){this.dataSource=e}async findAll(e,t,o){let r="SELECT * FROM sessions";const n=[],s=[];return o&&Object.entries(o).forEach((([e,t])=>{n.push(`${e} = ?`),s.push(t)})),n.length>0&&(r+=` WHERE ${n.join(" AND ")}`),t&&(r=this.dataSource.buildSortQuery(r,t)),e&&(r=this.dataSource.buildPaginationQuery(r,e)),this.dataSource.query(r,s)}async findById(e){return(await this.dataSource.query("SELECT * FROM sessions WHERE sessionId = ?",[e]))[0]||null}async create(e){await this.dataSource.run("INSERT INTO sessions (sessionId, workspaceName, status, createdAt) VALUES (?, ?, ?, ?)",[e.sessionId,e.workspaceName,e.status,e.createdAt])}async update(e,t){const o=Object.keys(t).map((e=>`${e} = ?`)).join(", "),r=Object.values(t);await this.dataSource.run(`UPDATE sessions SET ${o} WHERE sessionId = ?`,[...r,e])}async delete(e){await this.dataSource.run("DELETE FROM sessions WHERE sessionId = ?",[e])}async count(e){let t="SELECT COUNT(*) as count FROM sessions";const o=[];if(e){t+=` WHERE ${Object.entries(e).map((([e,t])=>(o.push(t),`${e} = ?`))).join(" AND ")}`}return(await this.dataSource.query(t,o))[0].count}};t.SessionRepository=c,t.SessionRepository=c=r([(0,i.Injectable)(),s(0,(0,i.Inject)("DATA_SOURCE")),n("design:paramtypes",[a.AppDataSource])],c)},7373:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SessionService=void 0;const s=o(3563),i=o(573),a=o(4434),c=o(3936),l=o(9095);let d=class{constructor(e,t){this.sessionRepository=e,this.itemRepository=t,this.eventEmitter=new a.EventEmitter}async getSessions(e=1,t=10,o="createdAt",r="DESC"){return{sessions:await this.sessionRepository.findAll({page:e,limit:t},{field:o,order:r}),total:await this.sessionRepository.count()}}async ensureSession(e,t){const o=await this.sessionRepository.findById(t);if(o){if(o.workspaceName!==e)throw new Error(`Session ${t} exists but belongs to a different workspace`);if("active"===o.status)throw new Error(`Session ${t} is currently active`);return o}const r={sessionId:t,workspaceName:e,status:"inactive",createdAt:new Date};return await this.sessionRepository.create(r),r}async getSession(e){return this.sessionRepository.findById(e)}async deleteSession(e){await this.sessionRepository.delete(e)}async getAllSessionsForWorkspace(e){return this.sessionRepository.findAll(void 0,void 0,{workspaceName:e})}async deleteSessionForWorkspace(e,t){await this.sessionRepository.delete(t)}async addItem(e,t,o){const r={itemId:this.generateItemId(),sessionId:e,label:t,content:o,createdAt:new Date};return await this.itemRepository.create(r),this.eventEmitter.emit("newItem",r),r}async getItemsForSession(e,t=1,o=100,r="ASC"){return[await this.itemRepository.findBySessionId(e,{page:t,limit:o},{field:"createdAt",order:r}),await this.itemRepository.countBySessionId(e)]}streamSessionItems(e){return new i.Observable((t=>{this.getItemsForSession(e).then((([e])=>{e.forEach((e=>{t.next({data:e})}))}));const o=o=>{o.sessionId===e&&t.next({data:o})};return this.eventEmitter.on("newItem",o),()=>{this.eventEmitter.removeListener("newItem",o)}}))}async updateSessionStatus(e,t){await this.sessionRepository.update(e,{status:t})}generateSessionId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="";for(let o=0;o<10;o++)t+=e.charAt(Math.floor(62*Math.random()));return t}generateItemId(){return"item_"+Math.random().toString(36).substr(2,9)}};t.SessionService=d,t.SessionService=d=r([(0,s.Injectable)(),n("design:paramtypes",[c.SessionRepository,l.ItemRepository])],d)},2397:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceController=void 0;const i=o(3563),a=o(8474);let c=class{constructor(e){this.workspaceService=e}async findAll(){return this.workspaceService.findAll()}async findOne(e){return this.workspaceService.findOne(e)}async create(e){return this.workspaceService.createWorkspace(e.repoBaseDir,e.name)}async update(e,t){return this.workspaceService.updateWorkspace(e,t.buildOrTestCommand)}async remove(e){return this.workspaceService.removeWorkspace(e)}};t.WorkspaceController=c,r([(0,i.Get)(),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],c.prototype,"findAll",null),r([(0,i.Get)(":name"),s(0,(0,i.Param)("name")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],c.prototype,"findOne",null),r([(0,i.Post)(),s(0,(0,i.Body)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],c.prototype,"create",null),r([(0,i.Patch)(":name"),s(0,(0,i.Param)("name")),s(1,(0,i.Body)()),n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",Promise)],c.prototype,"update",null),r([(0,i.Delete)(":name"),s(0,(0,i.Param)("name")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],c.prototype,"remove",null),t.WorkspaceController=c=r([(0,i.Controller)("workspace"),n("design:paramtypes",[a.WorkspaceService])],c)},5873:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceModule=void 0;const n=o(3563),s=o(2397),i=o(8474),a=o(4717),c=o(376);let l=class{};t.WorkspaceModule=l,t.WorkspaceModule=l=r([(0,n.Module)({imports:[c.DataSourceModule],controllers:[s.WorkspaceController],providers:[i.WorkspaceService,a.WorkspaceRepository],exports:[i.WorkspaceService]})],l)},4717:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(o,r){t(o,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceRepository=void 0;const i=o(3563),a=o(2776);let c=class{constructor(e){this.dataSource=e}async findAll(e,t){let o="SELECT * FROM workspaces";return t&&(o=this.dataSource.buildSortQuery(o,t)),e&&(o=this.dataSource.buildPaginationQuery(o,e)),this.dataSource.query(o)}async findByName(e){return(await this.dataSource.query("SELECT * FROM workspaces WHERE name = ?",[e]))[0]||null}async create(e){await this.dataSource.run("INSERT INTO workspaces (name, repoBaseDir, remoteRepoUrl, status, buildOrTestCommand) VALUES (?, ?, ?, ?, ?)",[e.name,e.repoBaseDir,e.remoteRepoUrl,e.status,e.buildOrTestCommand])}async update(e,t){const o=Object.keys(t).map((e=>`${e} = ?`)).join(", "),r=Object.values(t);await this.dataSource.run(`UPDATE workspaces SET ${o} WHERE name = ?`,[...r,e])}async delete(e){await this.dataSource.run("DELETE FROM workspaces WHERE name = ?",[e])}};t.WorkspaceRepository=c,t.WorkspaceRepository=c=r([(0,i.Injectable)(),s(0,(0,i.Inject)("DATA_SOURCE")),n("design:paramtypes",[a.AppDataSource])],c)},8474:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,o,i):n(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceService=void 0;const s=o(3563),i=o(4717),a=o(6928),c=o(5317),l=o(9023),d=o(9896),u=o(9055),f=(0,l.promisify)(c.exec);let p=class{constructor(e){this.workspaceRepository=e}async updateWorkspace(e,t){const o=await this.workspaceRepository.findByName(e);if(!o)throw new s.NotFoundException(`Workspace with name ${e} not found`);return o.buildOrTestCommand=t,await this.workspaceRepository.update(e,{buildOrTestCommand:t}),u.default.info(`Workspace updated successfully: ${JSON.stringify(o)}`),o}async createWorkspace(e,t){const o=t||a.basename(e);if(await this.workspaceRepository.findByName(o))throw new s.BadRequestException("A workspace with the same name already exists");if(!d.existsSync(e)||!d.statSync(e).isDirectory())throw new s.BadRequestException("The specified repository directory does not exist or is not a directory");try{await this.isValidGitRepo(e)}catch(e){throw new s.BadRequestException("The specified directory is not a valid git repository")}const r={name:o,repoBaseDir:e,status:"Created",remoteRepoUrl:"",buildOrTestCommand:null};try{r.remoteRepoUrl=await this.getRemoteRepoUrl(e),await this.getCurrentBranch(e)}catch(e){console.error("Error getting Git information:",e),r.status="Error: Unable to get Git information"}return await this.workspaceRepository.create(r),u.default.info(`Workspace created successfully: ${JSON.stringify(r)}`),r}async findAll(){return this.workspaceRepository.findAll()}async findOne(e){return this.workspaceRepository.findByName(e)}async removeWorkspace(e){if(!await this.workspaceRepository.findByName(e))throw new s.NotFoundException(`Workspace with name ${e} not found`);await this.workspaceRepository.delete(e),u.default.info(`Workspace removed successfully: ${e}`)}async getRemoteRepoUrl(e){const{stdout:t}=await f("git config --get remote.origin.url",{cwd:e});return t.trim()}async getCurrentBranch(e){const{stdout:t}=await f("git rev-parse --abbrev-ref HEAD",{cwd:e});return t.trim()}async isValidGitRepo(e){try{return await f("git rev-parse --is-inside-work-tree",{cwd:e}),!0}catch(e){return!1}}};t.WorkspaceService=p,t.WorkspaceService=p=r([(0,s.Injectable)(),n("design:paramtypes",[i.WorkspaceRepository])],p)},3765:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CommandLine=void 0;const r=o(3153),n=o(1569),s=o(5317),i=(0,o(9023).promisify)(s.exec);class a extends r.Tool{constructor(e){super(),this.name="command_line",this.description="Execute a command line instruction in the workspace directory",this.schema=n.z.object({command:n.z.string().describe("The command to execute")}),this.workspaceRootDir=e}async _call({command:e}){try{const{stdout:t,stderr:o}=await i(e,{cwd:this.workspaceRootDir});return`Executed Command:\n${e}\nOutput:\n${t}${o}`}catch(t){return`Executed Command:\n${e}\nError:\n${t.message}`}}}t.CommandLine=a},7465:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DeleteFile=void 0;const r=o(3153),n=o(1569),s=o(9896),i=o(6928);class a extends r.Tool{constructor(e){super(),this.name="delete_file",this.description="Delete a file from the workspace",this.schema=n.z.object({filePath:n.z.string().describe("The relative path of the file to delete")}),this.workspaceRootDir=e}async _call(e){return this.deleteFile(e.filePath)}deleteFile(e){const t=i.join(this.workspaceRootDir,e);try{return s.existsSync(t)?(s.unlinkSync(t),`Successfully deleted file: ${e}`):`Error: File not found - ${e}`}catch(e){return`Error deleting file: ${e.message}`}}}t.DeleteFile=a},7027:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DevOpsTool=void 0;const r=o(3153),n=o(1569),s=o(5317),i=(0,o(9023).promisify)(s.exec);t.DevOpsTool=(0,r.tool)((async({command:e})=>{try{const{stdout:t,stderr:o}=await i(e);return o?`Command executed with errors: ${o}`:t}catch(e){return`Error executing command: ${e.message}`}}),{name:"devops",description:"Execute a shell command and return the output.",schema:n.z.object({command:n.z.string().describe("The shell command to execute.")})})},4548:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExampleWeatherTool=void 0;const r=o(3153),n=o(1569);t.ExampleWeatherTool=(0,r.tool)((async({query:e})=>e.toLowerCase().includes("sf")||e.toLowerCase().includes("san francisco")?"It's 60 degrees and foggy in San Francisco.":"I'm sorry, I don't have weather information for that location."),{name:"weather",description:"Get the current weather for a location.",schema:n.z.object({query:n.z.string().describe("The location to get weather information for.")})})},4970:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReadFile=void 0;const r=o(3153),n=o(1569),s=o(9896),i=o(6928),a=o(9055);class c extends r.Tool{constructor(e){super(),this.name="read_file",this.description="Read the content of a file in the workspace",this.schema=n.z.object({filePath:n.z.string().describe("The relative path of the file to read")}),this.workspaceRootDir=e}async _call(e){return this.readFile(e.filePath)}readFile(e){a.default.debug("ReadFile.readFile called with:",{filePath:e});const t=i.join(this.workspaceRootDir,e);try{return s.readFileSync(t,"utf-8")}catch(t){return"ENOENT"===t.code?`Error: File not found - ${e}`:`Error reading file: ${t.message}`}}}t.ReadFile=c},5515:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReadWorkspaceTree=void 0;const r=o(3153),n=o(1569),s=o(9896),i=o(6928),a=o(526);class c extends r.Tool{constructor(e){super(),this.name="read_workspace_tree",this.description="Read the workspace file tree, respecting .gitignore and .aiderignore files",this.schema=n.z.object({}),this.workspaceRootDir=e}async _call(){return c.generateWorkspaceTree(this.workspaceRootDir)}static generateWorkspaceTree(e){if(!s.existsSync(e)||!s.statSync(e).isDirectory())return`Error: ${e} is not a valid directory.`;const t=c.parseIgnoreFiles(e);return`File tree for ${e}:\n.\n${c.generateTree(e,t,e)}`}static parseIgnoreFiles(e){const t=(0,a.default)();t.add([".git"]);return[".gitignore",".aiderignore"].forEach((o=>{const r=i.join(e,o);if(s.existsSync(r)){const e=s.readFileSync(r,"utf-8");t.add(e)}})),t}static generateTree(e,t,o,r=""){let n=[];const a=s.readdirSync(e).sort();return a.forEach(((l,d)=>{const u=i.join(e,l),f=i.relative(o,u);if(t.ignores(f))return;const p=d===a.length-1;n.push(`${r}${p?"└── ":"├── "}${l}`),s.statSync(u).isDirectory()&&n.push(c.generateTree(u,t,o,r+(p?"    ":"│   ")))})),n.join("\n")}}t.ReadWorkspaceTree=c},3923:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateFile=void 0;const r=o(3153),n=o(1569),s=o(9896),i=o(6928),a=o(9055),c=o(2303);class l extends r.Tool{constructor(e,t,o){super(),this.name="update_file",this.description="Update the content of a file in the workspace by providing the path of the file to update, the text block to search for in the file content, and the text block to replace the search block with. All 3 arguments are required filePath, search & replace.",this.schema=n.z.object({filePath:n.z.string().describe("The relative path of the file to update"),search:n.z.string().describe("The text block to search for in the file content"),replace:n.z.string().describe("The text block to replace the search block with - DO NOT FORGET TO INCLUDE THIS!!!")}),this.workspaceRootDir=e,this.mutationsService=t,this.sessionId=o}async _call(e){return this.updateFile(e.filePath,e.search,e.replace)}async updateFile(e,t,o){a.default.debug("UpdateFile.updateFile called with:",{filePath:e,search:t,replace:o});const r=i.join(this.workspaceRootDir,e);try{let n,a,l=!1;if(s.existsSync(r)||null!==t&&""!==t){n=s.readFileSync(r,"utf-8");const e=n.indexOf(t);if(-1===e)return"Error: failed to find search block in file content.";a=n.slice(0,e)+o+n.slice(e+t.length),s.writeFileSync(r,a,"utf-8")}else{const e=i.dirname(r);s.mkdirSync(e,{recursive:!0}),s.writeFileSync(r,o,"utf-8"),n="",a=o,l=!0}const d=l?`Successfully created new file: ${e}\n<<<<<<< CONTENT\n${o}\n>>>>>>>>`:`Successfully updated file: ${e}\n<<<<<<< SEARCH\n${t}\n=======\n${o}\n>>>>>>>> REPLACE\n`;return await this.mutationsService.createMutation({type:l?c.MutationType.CREATE:c.MutationType.UPDATE,filePath:e,description:d,fileContentsBefore:n,fileContentsAfter:a,updatedAt:new Date,sessionId:this.sessionId}),d}catch(t){return"ENOENT"===t.code?`Error: File not found - ${e}`:`Error updating file: ${t.message}`}}}t.UpdateFile=l},8884:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getEnv=function(e,t){let o;"undefined"!=typeof process&&process.env?o=process.env[e]:"undefined"!=typeof globalThis&&"Deno"in globalThis?o=globalThis.Deno.env.get(e):console.warn(`Unable to access environment variables. Key: ${e}`);return void 0!==o?o:t}},9055:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=o(5124),n=o(9896),s=o(6928),i=o(8884),a=s.join(__dirname,"..","..","logs");n.existsSync(a)||n.mkdirSync(a,{recursive:!0});const c=s.join(a,"server.log"),l=(0,i.getEnv)("LOG_FILE_PATH",c),d=r.createLogger({level:"debug",format:r.format.combine(r.format.timestamp(),r.format.json()),defaultMeta:{service:"hldk-server"},transports:[new r.transports.Console({level:"info"}),new r.transports.File({filename:l,level:"debug"})]});t.default=d},646:e=>{e.exports=require("@langchain/anthropic")},1486:e=>{e.exports=require("@langchain/core/messages")},3153:e=>{e.exports=require("@langchain/core/tools")},9314:e=>{e.exports=require("@langchain/langgraph")},8804:e=>{e.exports=require("@langchain/langgraph/prebuilt")},6228:e=>{e.exports=require("@langchain/openai")},3563:e=>{e.exports=require("@nestjs/common")},8781:e=>{e.exports=require("@nestjs/core")},9556:e=>{e.exports=require("@nestjs/platform-express")},2810:e=>{e.exports=require("@nestjs/serve-static")},818:e=>{e.exports=require("dotenv")},7252:e=>{e.exports=require("express")},526:e=>{e.exports=require("ignore")},8461:e=>{e.exports=require("multer")},5095:e=>{e.exports=require("node-flyway")},1321:e=>{e.exports=require("reflect-metadata")},573:e=>{e.exports=require("rxjs")},6689:e=>{e.exports=require("sqlite3")},3903:e=>{e.exports=require("uuid")},5124:e=>{e.exports=require("winston")},1569:e=>{e.exports=require("zod")},5317:e=>{e.exports=require("child_process")},4434:e=>{e.exports=require("events")},9896:e=>{e.exports=require("fs")},857:e=>{e.exports=require("os")},6928:e=>{e.exports=require("path")},9023:e=>{e.exports=require("util")}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,o),s.exports}(()=>{o(1321);const e=o(818),t=o(6928),r=o(8781),n=o(715),s=o(7252),i=o(6928),a=o(2776),c=o(9055);(0,e.config)({path:(0,t.resolve)(__dirname,"../.env")}),async function(){try{await(0,a.initializeDataSource)(),c.default.info("Database initialization and migration completed successfully")}catch(e){c.default.error("Error initializing database and running migrations:",e),process.exit(1)}const e=await r.NestFactory.create(n.AppModule);e.setGlobalPrefix("api"),e.enableCors({origin:["http://localhost:3011","http://localhost:3012","http://localhost:3013","http://localhost:3014"],methods:["GET","POST","PUT","PATCH","DELETE","OPTIONS"],allowedHeaders:"*",exposedHeaders:["Location"]}),e.use(s.static((0,i.join)(__dirname,"webui"))),e.use("*",((e,t,o)=>{e.originalUrl.startsWith("/api")?o():t.sendFile((0,i.join)(__dirname,"webui","index.html"))}));const t=process.env.PORT||3010;await e.listen(t);const o=`http://localhost:${t}`;console.log(`\nhldk-server is now available at: ${o}`)}()})()})();